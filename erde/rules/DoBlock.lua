-- -----------------------------------------------------------------------------
-- DoBlock
-- -----------------------------------------------------------------------------

local DoBlock = { ruleName = 'DoBlock' }

-- -----------------------------------------------------------------------------
-- Parse
-- -----------------------------------------------------------------------------

function DoBlock.parse(ctx, opts)
  ctx:assert('do')
  return {
    isExpr = opts and opts.isExpr,
    body = ctx:Surround('{', '}', ctx.Block),
  }
end

-- -----------------------------------------------------------------------------
-- Compile
-- -----------------------------------------------------------------------------

function DoBlock.compile(ctx, node)
  if node.isExpr then
    return '(function() ' .. ctx:compile(node.body) .. ' end)()'
  else
    return 'do\n' .. ctx:compile(node.body) .. '\nend'
  end
end

-- -----------------------------------------------------------------------------
-- Return
-- -----------------------------------------------------------------------------

return DoBlock
