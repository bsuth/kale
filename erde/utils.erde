local { PATH_SEPARATOR } = require('erde.constants')

module function echo(...) {
  return ...
}

module function shallowcopy(t) {
  local result = {}

  for key, value in pairs(t) {
    result[key] = value
  }

  return result
}

-- -----------------------------------------------------------------------------
-- Strings
-- -----------------------------------------------------------------------------

module function split(s, separator = '%s') {
  local parts = {}

  for part in s:gmatch("([^{ separator }]+)") {
    table.insert(parts, part)
  }

  return parts
}

-- Remove leading / trailing whitespace from a string.
-- Taken from: https://www.lua.org/pil/20.3.html
module function trim(s) {
  -- Store in local variable to ensure we return only 1 (stylua will remove wrapping parens)
  local trimmed = s:gsub('^%s*(.*)%s*$', '%1')
  return trimmed
}

module function get_source_summary(source) {
  local summary = trim(source):sub(1, 5)

  if #source > 5 {
    summary ..= '...'
  }

  return summary
}

module function get_source_alias(source) {
  return "[string \"{ get_source_summary(source) }\"]"
}

-- -----------------------------------------------------------------------------
-- Files
-- -----------------------------------------------------------------------------

module function file_exists(path) {
  local file = io.open(path, 'r')

  if file == nil {
    return false
  }

  file:close()
  return true
}

module function read_file(path) {
  local file = io.open(path)

  if file == nil {
    error("file does not exist: { path }")
  }

  local contents = file:read('*a')
  file:close()
  return contents
}

-- -----------------------------------------------------------------------------
-- Paths
-- -----------------------------------------------------------------------------

module function join_paths(...) {
  -- Store in local variable to ensure we return only 1 (stylua will remove wrapping parens)
  local joined = table.concat({ ... }, PATH_SEPARATOR):gsub(PATH_SEPARATOR .. '+', PATH_SEPARATOR)
  return joined
}
